{"ast":null,"code":"import { useEffect, useState } from 'react';\nimport { fetchWithLocalCache } from '../utils';\nimport data from './../data/last-update.json';\nexport function useData() {\n  let {\n    0: ready,\n    1: setReady\n  } = useState(false);\n  let {\n    0: versioning,\n    1: bumpVersioning\n  } = useState(false);\n  let {\n    0: weeks,\n    1: setWeeks\n  } = useState(false);\n  let {\n    0: sns,\n    1: setSns\n  } = useState(false);\n  let {\n    0: ecdc,\n    1: setECDC\n  } = useState(false);\n  let {\n    0: ars,\n    1: setArs\n  } = useState(false);\n  let {\n    0: vaccines,\n    1: setVaccines\n  } = useState(false);\n  let {\n    0: casesData,\n    1: setCasesData\n  } = useState(false);\n  let {\n    0: casos,\n    1: setCasos\n  } = useState({});\n  let {\n    0: labels,\n    1: setLabels\n  } = useState([]);\n  let {\n    0: values,\n    1: setValues\n  } = useState([]);\n  let {\n    0: intervalId,\n    1: setIntervalId\n  } = useState(null);\n  let options = {\n    month: 'short',\n    day: 'numeric'\n  };\n  let f = new Intl.DateTimeFormat('pt-PT', options);\n\n  function parseData(data) {\n    if (!ready) return;\n    let values = [];\n    let labels = [];\n    data.forEach(el => {\n      labels.push(f.format(new Date(el.Data)));\n      values.push(el.Vacinados_Ac);\n    });\n    return {\n      values,\n      labels\n    };\n  }\n\n  let statistics = {\n    getRaw: () => {\n      return vaccines;\n    },\n    getDailyData: () => {\n      return parseData(vaccines);\n    },\n    getDesvioPadrao: () => {},\n    getMediaMovel: dias => {\n      let medias = [];\n      let labelsMedias = [];\n      let {\n        labels,\n        values\n      } = parseData(vaccines);\n\n      for (let start = 1; start <= dias; start++) {\n        let sum = Math.round(values.slice(0, start).reduce((prev, current) => prev + current, 0) / start);\n        medias.push(sum);\n        labelsMedias.push(labels[start]);\n      }\n\n      for (let start = dias; start <= values.length; start++) {\n        let sum = Math.round(values.slice(start - dias, start).reduce((prev, current) => prev + current, 0) / dias);\n        medias.push(sum);\n        labelsMedias.push(labels[start]);\n      }\n\n      return {\n        values: medias,\n        labels: labelsMedias\n      };\n    },\n    getMediaMovelDiaria: dias => {\n      let medias = [];\n      let labelsMedias = [];\n      let {\n        values\n      } = statistics.getVacinadosPorDia();\n\n      for (let start = 1; start <= dias; start++) {\n        if (values[start] === null) {\n          medias.push(null);\n          continue;\n        }\n\n        let sum = Math.round(values.slice(0, start).reduce((prev, current) => prev + current, 0) / start);\n        medias.push(sum);\n        labelsMedias.push(labels[start]);\n      }\n\n      for (let start = dias; start <= values.length; start++) {\n        let slice = values.slice(start - dias, start);\n\n        if (values[start] === null || slice.includes(null) > 0) {\n          medias.push(null);\n          continue;\n        }\n\n        let sum = Math.round(slice.reduce((prev, current) => prev + current, 0) / dias);\n        medias.push(sum);\n        labelsMedias.push(labels[start]);\n      }\n\n      return {\n        values: medias,\n        labels: labelsMedias\n      };\n    },\n    getVacinadosPorDia: () => {\n      let {\n        labels,\n        values\n      } = statistics.getDailyData();\n      let vacinadosPorDia = values.map((val, idx, vals) => {\n        //The first one\n        if (idx === 0) {\n          return val;\n        }\n\n        let nextDay = idx - 1;\n\n        if (vals[nextDay] == null || val == null) {\n          return null;\n        }\n\n        return val - vals[nextDay];\n      });\n      return {\n        values: vacinadosPorDia,\n        labels\n      };\n    },\n    getVacinadosAcum: () => {\n      let in1 = [];\n      let in2 = [];\n      let total = [];\n      let {\n        labels,\n        values\n      } = statistics.getDailyData();\n      values.forEach((val, idx, vals) => {\n        in1.push(vaccines[idx].Inoculacao1_Ac);\n        in2.push(vaccines[idx].Inoculacao2_Ac);\n        total.push(vaccines[idx].Vacinados_Ac);\n      });\n      return {\n        valuesIn1: in1,\n        valuesIn2: in2,\n        values: total,\n        labels\n      };\n    },\n    getDiariosInoculacoes: () => {\n      let in1 = [];\n      let in2 = [];\n      let {\n        labels,\n        values\n      } = parseData(vaccines);\n      let total = values.map((val, idx, vals) => {\n        //The first one\n        if (idx === 0) {\n          in1.push(vaccines[idx].Inoculacao1_Ac);\n          in2.push(vaccines[idx].Inoculacao2_Ac);\n          return val;\n        }\n\n        let prevDay = idx - 1;\n\n        if (vaccines[prevDay].Inoculacao1_Ac == null || vaccines[idx].Inoculacao1_Ac == null) {\n          in1.push(null);\n        } else {\n          in1.push(vaccines[idx].Inoculacao1_Ac - vaccines[prevDay].Inoculacao1_Ac);\n        }\n\n        if (vaccines[prevDay].Inoculacao2_Ac == null || vaccines[idx].Inoculacao2_Ac == null) {\n          in2.push(null);\n        } else {\n          in2.push(vaccines[idx].Inoculacao2_Ac - vaccines[prevDay].Inoculacao2_Ac);\n        }\n\n        if (vals[prevDay] == null || val == null) {\n          return null;\n        }\n\n        return val - vals[prevDay];\n      });\n      return {\n        valuesIn1: in1,\n        valuesIn2: in2,\n        values: total,\n        raw: vaccines,\n        labels\n      };\n    },\n    getDiariosCases: () => {\n      let labels2 = [];\n      let values2 = [];\n      casesData.forEach(el => {\n        labels2.push(new Date(el.Data));\n        values2.push(el);\n      });\n      return {\n        labels: labels2,\n        values: values2,\n        raw: casesData\n      };\n    },\n    getReceivedDosesByBrandByWeek: async () => {\n      let labels = {};\n      let com = {};\n      let mod = {};\n      let az = {};\n      ecdc.forEach(el => {\n        var obj = {};\n\n        if (parseInt(el['Doses received']) > 0) {\n          com[el['Week']] = com[el['Week']] || null;\n          mod[el['Week']] = mod[el['Week']] || null;\n          az[el['Week']] = az[el['Week']] || null;\n          labels[el['Week']] = weeks[el['Week']];\n\n          if (el['Vaccine brand'] === 'COM') {\n            com[el['Week']] = parseInt(el['Doses received']);\n          }\n\n          if (el['Vaccine brand'] === 'MOD') {\n            mod[el['Week']] = parseInt(el['Doses received']);\n          }\n\n          if (el['Vaccine brand'] === 'AZ') {\n            az[el['Week']] = parseInt(el['Doses received']);\n          }\n        }\n      });\n      com = Object.values(com);\n      mod = Object.values(mod);\n      az = Object.values(az);\n      labels = Object.values(labels);\n      return {\n        com,\n        mod,\n        az,\n        labels\n      };\n    },\n    getAdministredDosesByAgeByWeek: async () => {\n      let labels = {};\n      let maxValue = 0;\n      let groups = {};\n      ecdc.forEach(el => {\n        if (el['Doses received'] == '') {\n          if (!labels.hasOwnProperty(el['Week'])) {\n            labels[el['Week'].replace('-', '')] = weeks[el['Week']];\n          }\n\n          groups[el['Group']] = groups[el['Group']] || {\n            dose_1: [],\n            dose_2: []\n          };\n          maxValue = Math.max(el['First dose'], el['Second dose']);\n          groups[el['Group']].dose_1[el['Week']] = (groups[el['Group']].dose_1[el['Week']] || 0) + parseInt(el['First dose']);\n          groups[el['Group']].dose_2[el['Week']] = (groups[el['Group']].dose_2[el['Week']] || 0) + parseInt(el['Second dose']);\n        }\n      });\n      return {\n        maxValue,\n        labels,\n        groups\n      };\n    },\n    getTotalAdministredDosesByAgeByWeek: async () => {\n      let labels = {};\n      let groups = {};\n      ecdc.forEach(el => {\n        if (el['Doses received'] == '') {\n          groups[el['Group']] = groups[el['Group']] || {\n            mod: [],\n            com: [],\n            az: [],\n            target: 0\n          };\n\n          if (el['Vaccine brand'] === 'COM') {\n            groups[el['Group']].com[0] = parseInt((groups[el['Group']].com[0] || 0) + parseInt(el['First dose']));\n            groups[el['Group']].com[1] = (groups[el['Group']].com[1] || 0) + parseInt(el['Second dose']);\n          }\n\n          if (el['Vaccine brand'] === 'MOD') {\n            groups[el['Group']].mod[0] = (groups[el['Group']].mod[0] || 0) + parseInt(el['First dose']);\n            groups[el['Group']].mod[1] = (groups[el['Group']].mod[1] || 0) + parseInt(el['Second dose']);\n          }\n\n          if (el['Vaccine brand'] === 'AZ') {\n            groups[el['Group']].az[0] = (groups[el['Group']].az[0] || 0) + parseInt(el['First dose']);\n            groups[el['Group']].az[1] = (groups[el['Group']].az[1] || 0) + parseInt(el['Second dose']);\n          }\n\n          groups[el['Group']].target = (groups[el['Group']].target || 0) + parseInt(el['Group population']);\n        }\n      });\n      return groups;\n    },\n    getTotalSNS: () => {\n      return sns.filter(el => {\n        debugger;\n        return (el.TYPE === 'REGIONAL' || el.TYPE === 'GENERAL') && el.DATE == data.dateSnsStartWeirdFormat;\n      });\n    },\n    getTotalARS: () => {\n      let data = {};\n      ars.features.forEach(el => {\n        if (el.attributes.ARSNome === 'Nacional') el.attributes.ARSNome = 'All';\n\n        if (!(el.attributes.ARSNome in data)) {\n          data[el.attributes.ARSNome] = {\n            obitosNovos7Dias: 0,\n            casosNovos7Dias: 0\n          };\n        }\n\n        data[el.attributes.ARSNome].obitosNovos7Dias += el.attributes.VarObitos;\n        data[el.attributes.ARSNome].casosNovos7Dias += el.attributes.ConfirmadosNovos;\n      });\n      return data;\n    },\n    getCases: () => {\n      return casesData;\n    },\n    getDosesRecebidasAcum: () => {\n      if (ecdc == false) return;\n      let labels = {};\n      let data = {};\n      let com = {};\n      let mod = {};\n      let az = {};\n      let sum = [];\n      let ecdcCopy = JSON.parse(JSON.stringify(ecdc));\n      let numbers = [1, 1, 1, 1];\n\n      function sumArray(array) {\n        return array.reduce((prev, current) => {\n          return prev + current;\n        }, 0);\n      }\n\n      ecdcCopy.filter(el => el['Doses received'] > 0).forEach(el => {\n        if (!labels.hasOwnProperty(el['Week'])) {\n          labels[el['Week']] = weeks[el['Week']];\n        }\n\n        com[el['Week']] = com[el['Week']] || 0;\n        mod[el['Week']] = mod[el['Week']] || 0;\n        az[el['Week']] = az[el['Week']] || 0;\n\n        if (el['Vaccine brand'] === 'COM') {\n          com[el['Week']] = parseInt(el['Doses received']);\n        }\n\n        if (el['Vaccine brand'] === 'MOD') {\n          mod[el['Week']] = parseInt(el['Doses received']);\n        }\n\n        if (el['Vaccine brand'] === 'AZ') {\n          az[el['Week']] = parseInt(el['Doses received']);\n        }\n      });\n      com = Object.values(com).reverse().map((el, idx, arr) => sumArray(arr.slice(idx, arr.length))).reverse();\n      az = Object.values(az).reverse().map((el, idx, arr) => sumArray(arr.slice(idx, arr.length))).reverse();\n      mod = Object.values(mod).reverse().map((el, idx, arr) => sumArray(arr.slice(idx, arr.length))).reverse();\n      sum = mod.map((el, idx, arr) => {\n        return com[idx] + az[idx] + mod[idx];\n      });\n      return {\n        mod,\n        com,\n        az,\n        sum,\n        labels\n      };\n    }\n  };\n  useEffect(() => {\n    Promise.all([fetchWithLocalCache('/api/ecdc', false, true), fetchWithLocalCache('/api/weeks', false, true), fetchWithLocalCache('/api/sns', false, false), fetchWithLocalCache('/api/vaccinesold'), fetchWithLocalCache('/api/ars', false, false), fetchWithLocalCache('/api/cases')]).then(([ecdc, weeks, sns, vaccines, ars, cases]) => {\n      setSns(sns);\n      setWeeks(weeks);\n      setECDC(ecdc);\n      setVaccines(vaccines);\n      setArs(ars);\n      setCasesData(cases);\n      setReady(true);\n    });\n  }, []);\n\n  function update(type, data) {\n    switch (type) {\n      case 'vacinas':\n        let arr = Array.from(vaccines);\n        arr.push(data);\n        setVaccines(arr);\n        bumpVersioning(versioning + 1);\n        break;\n\n      case 'casos':\n        //casos.push(data);\n        //setCasos(casos);\n        bumpVersioning(versioning + 1);\n        break;\n\n      case 'reload':\n        window.location.reload();\n        break;\n    }\n  }\n\n  return {\n    versioning,\n    statistics,\n    ready,\n    update\n  };\n}","map":{"version":3,"sources":["/home/pi/Web/mapa-vacinacao-c19/hooks/useData.js"],"names":["useEffect","useState","fetchWithLocalCache","data","useData","ready","setReady","versioning","bumpVersioning","weeks","setWeeks","sns","setSns","ecdc","setECDC","ars","setArs","vaccines","setVaccines","casesData","setCasesData","casos","setCasos","labels","setLabels","values","setValues","intervalId","setIntervalId","options","month","day","f","Intl","DateTimeFormat","parseData","forEach","el","push","format","Date","Data","Vacinados_Ac","statistics","getRaw","getDailyData","getDesvioPadrao","getMediaMovel","dias","medias","labelsMedias","start","sum","Math","round","slice","reduce","prev","current","length","getMediaMovelDiaria","getVacinadosPorDia","includes","vacinadosPorDia","map","val","idx","vals","nextDay","getVacinadosAcum","in1","in2","total","Inoculacao1_Ac","Inoculacao2_Ac","valuesIn1","valuesIn2","getDiariosInoculacoes","prevDay","raw","getDiariosCases","labels2","values2","getReceivedDosesByBrandByWeek","com","mod","az","obj","parseInt","Object","getAdministredDosesByAgeByWeek","maxValue","groups","hasOwnProperty","replace","dose_1","dose_2","max","getTotalAdministredDosesByAgeByWeek","target","getTotalSNS","filter","TYPE","DATE","dateSnsStartWeirdFormat","getTotalARS","features","attributes","ARSNome","obitosNovos7Dias","casosNovos7Dias","VarObitos","ConfirmadosNovos","getCases","getDosesRecebidasAcum","ecdcCopy","JSON","parse","stringify","numbers","sumArray","array","reverse","arr","Promise","all","then","cases","update","type","Array","from","window","location","reload"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport { fetchWithLocalCache } from '../utils';\nimport data from './../data/last-update.json';\nexport function useData() {\n\tlet [ready, setReady] = useState(false);\n\tlet [versioning, bumpVersioning] = useState(false);\n\tlet [weeks, setWeeks] = useState(false);\n\tlet [sns, setSns] = useState(false);\n\tlet [ecdc, setECDC] = useState(false);\n\tlet [ars, setArs] = useState(false);\n\tlet [vaccines, setVaccines] = useState(false);\n\tlet [casesData, setCasesData] = useState(false);\n\tlet [casos, setCasos] = useState({});\n\tlet [labels, setLabels] = useState([]);\n\tlet [values, setValues] = useState([]);\n\tlet [intervalId, setIntervalId] = useState(null);\n\n\tlet options = {\n\t\tmonth: 'short',\n\t\tday: 'numeric',\n\t};\n\tlet f = new Intl.DateTimeFormat('pt-PT', options);\n\tfunction parseData(data) {\n\t\tif (!ready) return;\n\t\tlet values = [];\n\t\tlet labels = [];\n\t\tdata.forEach((el) => {\n\t\t\tlabels.push(f.format(new Date(el.Data)));\n\t\t\tvalues.push(el.Vacinados_Ac);\n\t\t});\n\n\t\treturn {\n\t\t\tvalues,\n\t\t\tlabels,\n\t\t};\n\t}\n\n\tlet statistics = {\n\t\tgetRaw: () => {\n\t\t\treturn vaccines;\n\t\t},\n\t\tgetDailyData: () => {\n\t\t\treturn parseData(vaccines);\n\t\t},\n\t\tgetDesvioPadrao: () => {},\n\n\t\tgetMediaMovel: (dias) => {\n\t\t\tlet medias = [];\n\t\t\tlet labelsMedias = [];\n\t\t\tlet { labels, values } = parseData(vaccines);\n\n\t\t\tfor (let start = 1; start <= dias; start++) {\n\t\t\t\tlet sum = Math.round(values.slice(0, start).reduce((prev, current) => prev + current, 0) / start);\n\t\t\t\tmedias.push(sum);\n\t\t\t\tlabelsMedias.push(labels[start]);\n\t\t\t}\n\n\t\t\tfor (let start = dias; start <= values.length; start++) {\n\t\t\t\tlet sum = Math.round(values.slice(start - dias, start).reduce((prev, current) => prev + current, 0) / dias);\n\t\t\t\tmedias.push(sum);\n\t\t\t\tlabelsMedias.push(labels[start]);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tvalues: medias,\n\t\t\t\tlabels: labelsMedias,\n\t\t\t};\n\t\t},\n\n\t\tgetMediaMovelDiaria: (dias) => {\n\t\t\tlet medias = [];\n\t\t\tlet labelsMedias = [];\n\t\t\tlet { values } = statistics.getVacinadosPorDia();\n\n\t\t\tfor (let start = 1; start <= dias; start++) {\n\t\t\t\tif (values[start] === null) {\n\t\t\t\t\tmedias.push(null);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet sum = Math.round(values.slice(0, start).reduce((prev, current) => prev + current, 0) / start);\n\t\t\t\tmedias.push(sum);\n\t\t\t\tlabelsMedias.push(labels[start]);\n\t\t\t}\n\n\t\t\tfor (let start = dias; start <= values.length; start++) {\n\t\t\t\tlet slice = values.slice(start - dias, start);\n\n\t\t\t\tif (values[start] === null || slice.includes(null) > 0) {\n\t\t\t\t\tmedias.push(null);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet sum = Math.round(slice.reduce((prev, current) => prev + current, 0) / dias);\n\t\t\t\tmedias.push(sum);\n\t\t\t\tlabelsMedias.push(labels[start]);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tvalues: medias,\n\t\t\t\tlabels: labelsMedias,\n\t\t\t};\n\t\t},\n\n\t\tgetVacinadosPorDia: () => {\n\t\t\tlet { labels, values } = statistics.getDailyData();\n\t\t\tlet vacinadosPorDia = values.map((val, idx, vals) => {\n\t\t\t\t//The first one\n\t\t\t\tif (idx === 0) {\n\t\t\t\t\treturn val;\n\t\t\t\t}\n\n\t\t\t\tlet nextDay = idx - 1;\n\t\t\t\tif (vals[nextDay] == null || val == null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn val - vals[nextDay];\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tvalues: vacinadosPorDia,\n\t\t\t\tlabels,\n\t\t\t};\n\t\t},\n\n\t\tgetVacinadosAcum: () => {\n\t\t\tlet in1 = [];\n\t\t\tlet in2 = [];\n\t\t\tlet total = [];\n\t\t\tlet { labels, values } = statistics.getDailyData();\n\t\t\tvalues.forEach((val, idx, vals) => {\n\t\t\t\tin1.push(vaccines[idx].Inoculacao1_Ac);\n\t\t\t\tin2.push(vaccines[idx].Inoculacao2_Ac);\n\t\t\t\ttotal.push(vaccines[idx].Vacinados_Ac);\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tvaluesIn1: in1,\n\t\t\t\tvaluesIn2: in2,\n\t\t\t\tvalues: total,\n\t\t\t\tlabels,\n\t\t\t};\n\t\t},\n\t\tgetDiariosInoculacoes: () => {\n\t\t\tlet in1 = [];\n\t\t\tlet in2 = [];\n\t\t\tlet { labels, values } = parseData(vaccines);\n\n\t\t\tlet total = values.map((val, idx, vals) => {\n\t\t\t\t//The first one\n\t\t\t\tif (idx === 0) {\n\t\t\t\t\tin1.push(vaccines[idx].Inoculacao1_Ac);\n\t\t\t\t\tin2.push(vaccines[idx].Inoculacao2_Ac);\n\t\t\t\t\treturn val;\n\t\t\t\t}\n\n\t\t\t\tlet prevDay = idx - 1;\n\n\t\t\t\tif (vaccines[prevDay].Inoculacao1_Ac == null || vaccines[idx].Inoculacao1_Ac == null) {\n\t\t\t\t\tin1.push(null);\n\t\t\t\t} else {\n\t\t\t\t\tin1.push(vaccines[idx].Inoculacao1_Ac - vaccines[prevDay].Inoculacao1_Ac);\n\t\t\t\t}\n\n\t\t\t\tif (vaccines[prevDay].Inoculacao2_Ac == null || vaccines[idx].Inoculacao2_Ac == null) {\n\t\t\t\t\tin2.push(null);\n\t\t\t\t} else {\n\t\t\t\t\tin2.push(vaccines[idx].Inoculacao2_Ac - vaccines[prevDay].Inoculacao2_Ac);\n\t\t\t\t}\n\n\t\t\t\tif (vals[prevDay] == null || val == null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn val - vals[prevDay];\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tvaluesIn1: in1,\n\t\t\t\tvaluesIn2: in2,\n\t\t\t\tvalues: total,\n\t\t\t\traw: vaccines,\n\t\t\t\tlabels,\n\t\t\t};\n\t\t},\n\t\tgetDiariosCases: () => {\n\t\t\tlet labels2 = [];\n\t\t\tlet values2 = [];\n\n\t\t\tcasesData.forEach((el) => {\n\t\t\t\tlabels2.push(new Date(el.Data));\n\t\t\t\tvalues2.push(el);\n\t\t\t});\n\n\t\t\treturn { labels: labels2, values: values2, raw: casesData };\n\t\t},\n\t\tgetReceivedDosesByBrandByWeek: async () => {\n\t\t\tlet labels = {};\n\n\t\t\tlet com = {};\n\t\t\tlet mod = {};\n\t\t\tlet az = {};\n\n\t\t\tecdc.forEach((el) => {\n\t\t\t\tvar obj = {};\n\t\t\t\tif (parseInt(el['Doses received']) > 0) {\n\t\t\t\t\tcom[el['Week']] = com[el['Week']] || null;\n\t\t\t\t\tmod[el['Week']] = mod[el['Week']] || null;\n\t\t\t\t\taz[el['Week']] = az[el['Week']] || null;\n\t\t\t\t\tlabels[el['Week']] = weeks[el['Week']];\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'COM') {\n\t\t\t\t\t\tcom[el['Week']] = parseInt(el['Doses received']);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'MOD') {\n\t\t\t\t\t\tmod[el['Week']] = parseInt(el['Doses received']);\n\t\t\t\t\t}\n\t\t\t\t\tif (el['Vaccine brand'] === 'AZ') {\n\t\t\t\t\t\taz[el['Week']] = parseInt(el['Doses received']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcom = Object.values(com);\n\t\t\tmod = Object.values(mod);\n\t\t\taz = Object.values(az);\n\n\t\t\tlabels = Object.values(labels);\n\n\t\t\treturn {\n\t\t\t\tcom,\n\t\t\t\tmod,\n\t\t\t\taz,\n\t\t\t\tlabels,\n\t\t\t};\n\t\t},\n\t\tgetAdministredDosesByAgeByWeek: async () => {\n\t\t\tlet labels = {};\n\t\t\tlet maxValue = 0;\n\n\t\t\tlet groups = {};\n\n\t\t\tecdc.forEach((el) => {\n\t\t\t\tif (el['Doses received'] == '') {\n\t\t\t\t\tif (!labels.hasOwnProperty(el['Week'])) {\n\t\t\t\t\t\tlabels[el['Week'].replace('-', '')] = weeks[el['Week']];\n\t\t\t\t\t}\n\n\t\t\t\t\tgroups[el['Group']] = groups[el['Group']] || {\n\t\t\t\t\t\tdose_1: [],\n\t\t\t\t\t\tdose_2: [],\n\t\t\t\t\t};\n\t\t\t\t\tmaxValue = Math.max(el['First dose'], el['Second dose']);\n\t\t\t\t\tgroups[el['Group']].dose_1[el['Week']] = (groups[el['Group']].dose_1[el['Week']] || 0) + parseInt(el['First dose']);\n\t\t\t\t\tgroups[el['Group']].dose_2[el['Week']] = (groups[el['Group']].dose_2[el['Week']] || 0) + parseInt(el['Second dose']);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tmaxValue,\n\t\t\t\tlabels,\n\t\t\t\tgroups,\n\t\t\t};\n\t\t},\n\t\tgetTotalAdministredDosesByAgeByWeek: async () => {\n\t\t\tlet labels = {};\n\n\t\t\tlet groups = {};\n\n\t\t\tecdc.forEach((el) => {\n\t\t\t\tif (el['Doses received'] == '') {\n\t\t\t\t\tgroups[el['Group']] = groups[el['Group']] || {\n\t\t\t\t\t\tmod: [],\n\t\t\t\t\t\tcom: [],\n\t\t\t\t\t\taz: [],\n\t\t\t\t\t\ttarget: 0,\n\t\t\t\t\t};\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'COM') {\n\t\t\t\t\t\tgroups[el['Group']].com[0] = parseInt((groups[el['Group']].com[0] || 0) + parseInt(el['First dose']));\n\t\t\t\t\t\tgroups[el['Group']].com[1] = (groups[el['Group']].com[1] || 0) + parseInt(el['Second dose']);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'MOD') {\n\t\t\t\t\t\tgroups[el['Group']].mod[0] = (groups[el['Group']].mod[0] || 0) + parseInt(el['First dose']);\n\t\t\t\t\t\tgroups[el['Group']].mod[1] = (groups[el['Group']].mod[1] || 0) + parseInt(el['Second dose']);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'AZ') {\n\t\t\t\t\t\tgroups[el['Group']].az[0] = (groups[el['Group']].az[0] || 0) + parseInt(el['First dose']);\n\t\t\t\t\t\tgroups[el['Group']].az[1] = (groups[el['Group']].az[1] || 0) + parseInt(el['Second dose']);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroups[el['Group']].target = (groups[el['Group']].target || 0) + parseInt(el['Group population']);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn groups;\n\t\t},\n\t\tgetTotalSNS: () => {\n\t\t\treturn sns.filter((el) => {\n\t\t\t\tdebugger;\n\t\t\t\treturn (el.TYPE === 'REGIONAL' || el.TYPE === 'GENERAL') && el.DATE == data.dateSnsStartWeirdFormat;\n\t\t\t});\n\t\t},\n\t\tgetTotalARS: () => {\n\t\t\tlet data = {};\n\t\t\tars.features.forEach((el) => {\n\t\t\t\tif (el.attributes.ARSNome === 'Nacional') el.attributes.ARSNome = 'All';\n\t\t\t\tif (!(el.attributes.ARSNome in data)) {\n\t\t\t\t\tdata[el.attributes.ARSNome] = {\n\t\t\t\t\t\tobitosNovos7Dias: 0,\n\t\t\t\t\t\tcasosNovos7Dias: 0,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tdata[el.attributes.ARSNome].obitosNovos7Dias += el.attributes.VarObitos;\n\t\t\t\tdata[el.attributes.ARSNome].casosNovos7Dias += el.attributes.ConfirmadosNovos;\n\t\t\t});\n\t\t\treturn data;\n\t\t},\n\t\tgetCases: () => {\n\t\t\treturn casesData;\n\t\t},\n\t\tgetDosesRecebidasAcum: () => {\n\t\t\tif (ecdc == false) return;\n\t\t\tlet labels = {};\n\t\t\tlet data = {};\n\t\t\tlet com = {};\n\t\t\tlet mod = {};\n\t\t\tlet az = {};\n\t\t\tlet sum = [];\n\n\t\t\tlet ecdcCopy = JSON.parse(JSON.stringify(ecdc));\n\n\t\t\tlet numbers = [1, 1, 1, 1];\n\n\t\t\tfunction sumArray(array) {\n\t\t\t\treturn array.reduce((prev, current) => {\n\t\t\t\t\treturn prev + current;\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\tecdcCopy\n\t\t\t\t.filter((el) => el['Doses received'] > 0)\n\t\t\t\t.forEach((el) => {\n\t\t\t\t\tif (!labels.hasOwnProperty(el['Week'])) {\n\t\t\t\t\t\tlabels[el['Week']] = weeks[el['Week']];\n\t\t\t\t\t}\n\n\t\t\t\t\tcom[el['Week']] = com[el['Week']] || 0;\n\t\t\t\t\tmod[el['Week']] = mod[el['Week']] || 0;\n\t\t\t\t\taz[el['Week']] = az[el['Week']] || 0;\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'COM') {\n\t\t\t\t\t\tcom[el['Week']] = parseInt(el['Doses received']);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'MOD') {\n\t\t\t\t\t\tmod[el['Week']] = parseInt(el['Doses received']);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (el['Vaccine brand'] === 'AZ') {\n\t\t\t\t\t\taz[el['Week']] = parseInt(el['Doses received']);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tcom = Object.values(com)\n\t\t\t\t.reverse()\n\t\t\t\t.map((el, idx, arr) => sumArray(arr.slice(idx, arr.length)))\n\t\t\t\t.reverse();\n\n\t\t\taz = Object.values(az)\n\t\t\t\t.reverse()\n\t\t\t\t.map((el, idx, arr) => sumArray(arr.slice(idx, arr.length)))\n\t\t\t\t.reverse();\n\n\t\t\tmod = Object.values(mod)\n\t\t\t\t.reverse()\n\t\t\t\t.map((el, idx, arr) => sumArray(arr.slice(idx, arr.length)))\n\t\t\t\t.reverse();\n\n\t\t\tsum = mod.map((el, idx, arr) => {\n\t\t\t\treturn com[idx] + az[idx] + mod[idx];\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tmod,\n\t\t\t\tcom,\n\t\t\t\taz,\n\t\t\t\tsum,\n\t\t\t\tlabels,\n\t\t\t};\n\t\t},\n\t};\n\n\tuseEffect(() => {\n\t\tPromise.all([\n\t\t\tfetchWithLocalCache('/api/ecdc', false, true),\n\t\t\tfetchWithLocalCache('/api/weeks', false, true),\n\t\t\tfetchWithLocalCache('/api/sns', false, false),\n\t\t\tfetchWithLocalCache('/api/vaccinesold'),\n\t\t\tfetchWithLocalCache('/api/ars', false, false),\n\t\t\tfetchWithLocalCache('/api/cases'),\n\t\t]).then(([ecdc, weeks, sns, vaccines, ars, cases]) => {\n\t\t\tsetSns(sns);\n\t\t\tsetWeeks(weeks);\n\t\t\tsetECDC(ecdc);\n\t\t\tsetVaccines(vaccines);\n\t\t\tsetArs(ars);\n\t\t\tsetCasesData(cases);\n\t\t\tsetReady(true);\n\t\t});\n\t}, []);\n\n\tfunction update(type, data) {\n\t\tswitch (type) {\n\t\t\tcase 'vacinas':\n\t\t\t\tlet arr = Array.from(vaccines);\n\t\t\t\tarr.push(data);\n\t\t\t\tsetVaccines(arr);\n\t\t\t\tbumpVersioning(versioning + 1);\n\t\t\t\tbreak;\n\n\t\t\tcase 'casos':\n\t\t\t\t//casos.push(data);\n\t\t\t\t//setCasos(casos);\n\t\t\t\tbumpVersioning(versioning + 1);\n\t\t\t\tbreak;\n\n\t\t\tcase 'reload':\n\t\t\t\twindow.location.reload();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn { versioning, statistics, ready, update };\n}\n"]},"metadata":{},"sourceType":"module"}