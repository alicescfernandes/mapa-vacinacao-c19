{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport Plausible from 'plausible-tracker';\nimport { useEffect } from 'react';\nvar firebaseConfig = {\n  apiKey: 'AIzaSyBcHZc1Rk5CeJDkwwaBOdCzYgdA6V5WK3g',\n  authDomain: 'covid19-249f1.firebaseapp.com',\n  projectId: 'covid19-249f1',\n  storageBucket: 'covid19-249f1.appspot.com',\n  messagingSenderId: '636238011730',\n  appId: '1:636238011730:web:bf4a0deef86c884c3b6e8b',\n  measurementId: 'G-DYYRVR03RS'\n};\nexport function Notifications({\n  children\n}) {\n  const plausible = Plausible({\n    domain: 'vacinacaocovid19.pt',\n    trackLocalhost: true\n  });\n\n  function registerOnFirebase(callback) {\n    if (firebase.apps.length === 0) {\n      firebase.initializeApp(firebaseConfig);\n    }\n\n    const messaging = firebase.messaging();\n    messaging.getToken({\n      vapidKey: 'BHtOyn7DJeWzTT1uCITnVOzCpFI4jyOGNo_NQCKoJktP56tHqSVCPtyn99tgpWPRsWzRTu07ahM6fjljP_01K3g'\n    }).then((currentToken, b, c) => {\n      if (currentToken) {\n        fetch('/api/messaging/register', {\n          method: 'POST',\n          body: JSON.stringify({\n            fcm_token: currentToken\n          }),\n          headers: {\n            'content-type': 'application/json'\n          }\n        }).then(res => {\n          plausible.trackEvent('notifications', {\n            type: 'granted'\n          });\n          callback === null || callback === void 0 ? void 0 : callback();\n        });\n      } else {\n        console.log('No registration token available. Request permission to generate one.');\n      }\n    }).catch(err => {\n      alert('Não conseguimos ativar as notificações. Certifique-se que não estão bloqueadas para este site ou tente mais tarde.');\n    });\n    messaging.onMessage(payload => {\n      let n = new Notification(payload.notification.title, {\n        body: payload.notification.body,\n        icon: '/android-icon-192x192.png'\n      });\n\n      n.onclick = function (event) {\n        window.open('https://www.vacinacaocovid19.pt/?utm_source=notifications&utm_medium=notifications&utm_campaign=notifications');\n      };\n    });\n  }\n\n  function allowNotifications() {\n    if (Notification.permission === 'granted') {\n      alert('Já recebes as nossas notificações');\n      return;\n    }\n\n    registerOnFirebase(function () {\n      new Notification('Vacinação COVID-19', {\n        body: 'Subscreveste às nossas notificações diárias com os dados das vacinas',\n        icon: '/android-icon-192x192.png'\n      });\n    });\n  }\n\n  useEffect(function () {\n    if (Notification.permission === 'granted') {\n      registerOnFirebase();\n    }\n  }, []);\n  return /*#__PURE__*/_jsxs(\"span\", {\n    onClick: allowNotifications,\n    children: [children, \" \"]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}