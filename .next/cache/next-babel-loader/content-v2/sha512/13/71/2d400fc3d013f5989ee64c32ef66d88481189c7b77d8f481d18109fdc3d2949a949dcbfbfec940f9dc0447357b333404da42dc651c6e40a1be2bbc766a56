{"ast":null,"code":"const fetch = require('node-fetch');\n\nexport default async function handler(req, res) {\n  let resSesaram = await fetch('https://web.sesaram.pt/COVID19_INFO', {\n    headers: {\n      accept: '*/*',\n      origin: 'https://web.sesaram.pt',\n      'accept-language': 'en-GB,en-US;q=0.9,en;q=0.8',\n      'content-type': 'application/x-www-form-urlencoded',\n      'sec-ch-ua': '\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"90\", \"Google Chrome\";v=\"90\"',\n      'sec-ch-ua-mobile': '?0',\n      'sec-fetch-dest': 'empty',\n      'sec-fetch-mode': 'cors',\n      'sec-fetch-site': 'same-origin'\n    },\n    referrer: 'https://web.sesaram.pt/COVID19_INFO',\n    referrerPolicy: 'strict-origin-when-cross-origin',\n    method: 'POST',\n    mode: 'cors',\n    credentials: 'omit'\n  });\n  let text = await resSesaram.text();\n  let url = new RegExp(/action=\"(.*)\".*target/gm);\n  let a = url.exec(text)[1];\n  resSesaram = await fetch('https://web.sesaram.pt/' + a, {\n    headers: {\n      accept: '*/*',\n      origin: 'https://web.sesaram.pt',\n      'accept-language': 'en-GB,en-US;q=0.9,en;q=0.8',\n      'content-type': 'application/x-www-form-urlencoded',\n      'sec-ch-ua': '\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"90\", \"Google Chrome\";v=\"90\"',\n      'sec-ch-ua-mobile': '?0',\n      'sec-fetch-dest': 'empty',\n      'sec-fetch-mode': 'cors',\n      'sec-fetch-site': 'same-origin'\n    },\n    referrer: 'https://web.sesaram.pt/COVID19_INFO',\n    referrerPolicy: 'strict-origin-when-cross-origin',\n    body: 'WD_ACTION_=AJAXEXECUTE&EXECUTEPROC=PAGE_VACINACAO.obtemTotalVacinasAdministradas&WD_CONTEXTE_=',\n    method: 'POST',\n    mode: 'cors',\n    credentials: 'omit'\n  });\n  text = await resSesaram.text();\n  let [d1, d2, total] = text.split('|');\n  let body = {\n    total: parseInt(total),\n    dose_1: parseInt(d1),\n    dose_2: parseInt(d2),\n    data: Date.now()\n  };\n  res.statusCode = 200;\n  res.json(body);\n}","map":null,"metadata":{},"sourceType":"module"}